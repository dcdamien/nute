Антон Страхов – Предварительная модель взаимодействия
Сущности
Сервер
Хранит состояние системы и обрабатывает поступающие события. Взаимодействие сервера с девайсами позволяет два варианта:
асинхронный: обмен событями. Это - основной способ изменения состояния.
синхронный: девайс может запросить от сервера какую-то информацию.
Для передачи данных между сервером и девайсами используется JSON (возражения принимаются) и WebSocket или Comet (возражения также принимаются) и простых AJAX-запросов.
Девайсы
Здесь девайс - это любая внешняя сущность, будь то железная или програмная, которая взаимодействует с сервером.
Объекты
Объект - это любая сущность, поведение и состояние которой симулируется сервером. Каждому объекту соответствует постоянный и уникальный ID
Базовые варианты взаимодействия
События передаются в виде объектов, с обязательным полем event_type. Это поле - строка, указывающая тип события в виде "<Type>/<Subtype>/<Subsubtype>". Например, "Control/Power/Down". Все остальные поля могут содержать дополнительные данные, связанные с событием.
Запросы отправляются на заранее определенные адреса и возвращают объект с ответом и код 200/OK в случае успеха, либо код ошибки (403, 404, 500...)
Примеры событий
Control/Power/Down
{ "event_type": "Control/Power/Down" } 
От сервера девайсу, если у него упало питание.
Ожидаемое поведение для терминала: черный экран.
Control/Power/Off
{ "event_type": "Control/Power/Off" } 
От сервера девайсу, если девайс отключен
Ожидаемое поведение для терминала: экран, с указанием того, что девайс выключен.
Control/Power/Off
{ "event_type": "Control/Power/Off", "id": "930a202e-af54-4e25-b5dd-8278f21562ba" } 
От девайсу серверу, если девайс запрашивает выключение объекта с заданным ID
Ожидаемая реакция сервера: если девайс может посылать такое событие (есть права), то на указанный девайс отправляется событие Control/Power/Off
Control/Power/Change
{ "event_type": "Control/Power/Change", "value": "50%" } 
От сервера девайсу, если его питание изменилось (стало равным 50%)
Ожидаемое поведение - вывод предупреждающего значка?
Примеры запросов
get_state
адрес: <host>/get_state данные запроса: id: 930a202e-af54-4e25-b5dd-8278f21562ba 
Получение состояния объекта с указанным ID
get_state
адрес: <host>/get_state данные запроса: id: 930a202e-af54-4e25-b5dd-8278f21562ba tag: power 
Получение частичного состояния объекта с указанным ID - интересуемся только полями, относящимися к энергосистеме.