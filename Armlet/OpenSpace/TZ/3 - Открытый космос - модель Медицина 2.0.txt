Открытый космос - модель Медицина 2.0

Болезни. Под "болезнь" понимаем любое медицинское событие на игре - подключение пилюли с наркотой/лекарствами/гелями, пост-операционное состояние, сами болезни)

Общий алгоритм

1 - старт болезни.
2 - выбор цепочки в зависимости от состояния систем.
3. - обработка событий цепочек, изменение параметров игрока
4.  - после того, как все цепочки болезни закончились - обработка иммунитета
5.  - конец болезни

Старт болезни вызывается игроком (на браслете - Медицина/Добавить проблему/список) или сервером (по таймеру, по событию с сервера). Проверка id игрока на "видовой признак" для выбора хода болезни (цепочки пост-людей, марсиан, репликантов, etc). 
Добавляем в список "состояние игрока" нужную проблему. 
Старт цепочки событий для систем:
"Пищеварительная" 
"Дыхательная" 
"Нервная" 
"Мозг" 
"Сердечно-сосудистая" 
"Опорно-двигательный аппарат" 
Для каждой из этих систем проверяем, есть ли там вообще цепочка событий в состоянии система (норма,ослаблена, отказала)
Состоянию "норма" и "ослаблена" присвоены свои цепочки событий. 
При состоянии "отказала" - болезнь ожидает, пока состояние не изменится.
Цепочки событий систем действуют независимо друг от друга. 
Событие в цепочке - это изменение параметров игрока или добавление/удаление симптома. 
У каждого события свой таймер, по истечению которого происходит следующее событие в данной цепочке.
Старт события = появление/исчезновение симптома и/или изменение параметров.

Симптом - это текстовое описание, добавляется в раздел Поведение, в топ списка паттернов, с тегом "симптом", с заголовком "новый" или "симптом исчез").
Если при добавлении симптома обнаружен такой же симптом, уже действующий от другого события или болезни, совпавший симптом выводится в топ списка паттернов поведения с тегами "новый". Т.е фактически мы сообщаем игроку, что у него "болит то же самое" столько раз, сколько нужно.
После отправки симптома включается уведомление игрока на браслете (вибро, пищалка, мигание раздела Поведение, мигание симптома/иконки в списке).
Если при удалении симптома обнаружен такой же симптом, уже действующий от другого события или болезни, совпавший симптом выводится в топ списка с тегом  "симптом исчез". После подтверждения от игрока о прочтении, симптом не удаляется из списка, только убираем  тэг. Так до тех пор, пока не исчезнут все симптомы (последний честно убираем из списка). 

Изменение параметров бывает:
а) температура
б) систолическое давление
в) диастолическое давление
г) изменение состояния системы (ослабление/усиление/отказ)
д) изменение состояния органа
е) изменение состояния импланта

Таймер изменения температуры и давления = 5 минут. В течении этого таймера параметры температуры,  систолическое и диастолическое артериальное давление изменяются на значения данного события (каждые 30 секунд по 10% от значения). 
В случае, если следующее событие имеет флаг "необратимое последствие" или "критическое состояние" то в тексте описания симптома добавляется предупреждение ("Внимание! Продолжение болезни вызывает критическое состояние"/"Продолжение болезни вызывает необратимые последствия") и запрос на продолжение болезни игроком ("отложить" на кнопке C, "продолжаем" на кнопке Z). Нельзя уйти с экрана, не сделав выбор. Любой из них вызывает переход к следующему паттерну в списке.
Таймер следующего события стартует в любом случае, но если подтверждения от игрока не было - симптомы не добавляются, параметры не изменяются, событие уходит в стек. 

Если игрок отложил решение - через 30 минут присылаем напоминание - вибро, пищалка, мигание раздела Поведение, мигание симптома/иконки в списке (снова ставим его в топ списка)

При подтверждении игроком продолжения болезни, проверка, сколько осталось времени у таймера следующего события в стеке цепочки. 
Если больше 10 минут - ничего не делаем, ждем окончания таймера, далее обрабатываем событие.
Если меньше 10 минут - стартуем таймер паузы, рандом 3-10 минут, далее проверяем таймер.
Когда все цепочки болезни отыграли, делаем рандом выборку систем "ослаблена" (исключая систему "Иммунная"). Проверяем, не идет ли таймер восстановления системы для него. Если таймер есть - выбираем другую систему. Если других "ослабленных" систем нет - ничего не делаем, следующий пункт.
В соответствии с параметром системы "Иммунная" :
7-8. старт таймера 15 минут, 
5-6. таймер 60 минут,
3-4. таймер 90
1-2. ничего не делаем

По окончанию таймера изменяем состояние системы на "норм". Если система уже "норм" или "отказала" - ничего не делаем, следующий пункт.
Механизм восстановление слабых систем так же стартует, если никакой таймер восстановления не запущен И нет ни одной болезни.
Конец болезни. Таймер восстановление параметров температуры и давления 5 минут (каждые 30 сек по 10% от значения для текущей болезни). Обновляем список "состояние игрока"

Внимание! Проверка на состояние системы только один раз за болезнь для каждой болезни! Т.е. если цепочка изменила состояние системы на "ослаблено" - мы не запускаем эту или другие цепочки текущей болезни заново.

Параметры игрока (медицинские)
           Стресс - переменная от 0 до 7
стресс эго
стресс жестокости
стресс беспомощности

Параметры диагностики
температура - переменная вида Х,ХХ
давление систолическое - переменная
давление диастолическое - переменная

Состояние органа - 4 стадии (норма, поврежден, требует пересадки, отказал)
"легкие"
"сердце"
"желудок"

Состояние системы
"Пищеварительная" (норма, ослаблена, отказала)
"Дыхательная" (норма, ослаблена, отказала)
"Нервная" (норма, ослаблена, отказала)
"Мозг" (норма, ослаблена, отказала)
"Сердечно-сосудистая" (норма, ослаблена, отказала)
"Опорно-двигательный аппарат" (норма, ослаблена, отказала)
"Иммунная" (1-8)

Состояние болезни
болен
не болен

          Состояние здоровья
Не поврежден
Избит
Повреждение конечности
Ранение корпуса (верх)
Ранение корпуса (низ)
Травма головы
Оглушен
При смерти
Труп

Импланты
тип
состояние (работает/не работает/поврежден)


===

Антон Страхов – В течении дня решаем внутри МК по фазам - делать запрос на продолжение игроку после каждой или только критические
Posted on Jun 22
Alexey Keltur
Alexey Keltur – пункт 3 - Когда все цепочки болезни отыграли, делаем проверку системы "Эндокринная/Иммунитет"

я не понимаю для каких целей он считается?
также сейчас есть тексты симптомов, но нет логики как меняются параметры при ходе болезни (они берутся с сервера? они считаются на браслете?) - особенно для органов и имплантов.
Posted on Jun 27
Alexey Keltur
Alexey Keltur – для каждой болезни есть цепочка событий - их нужно кодировать!?
мне нужны таблицы что события от болезни делает с параметрами!
событие простое (изменение параметра) или что-то сложное (проверки состояний и различные эффекты в зависимости от состояния)?
Posted on Jun 27
Антон Страхов
Антон Страхов – Иммунитет изменил - он вот так должен работать. Восстанавливает слабые системы.
Логика изменения параметров задана цепочками событий систем, они разные для разных болезней. 
Считается все на браслете, сервер может только прислать старт болезни.
Цепочки событий есть в виде последовательности - их мы отдаем готовыми для всех болезней.
Мастера уверяют меня, что событие делает простое изменение параметров, а сложных проверок и эффектов - нету. Поверим им )
Posted on Jun 27, updated 2 minutes later
Антон Страхов
Антон Страхов – Цепочки медицинских событий https://docs.google.com/document/d/1MTMF70qyeC37KWW8BbZ39rP7RXDkNCFmHyZtTm8rKFo/edit
Posted on Jun 27
Vasya Shatrov
Vasya Shatrov – Я готов активно курировать написание медицины. Я переписал всё (всю медицину и лекарства) под то, что сказал Бублик и готов активно сотрудничать. Если есть возможность, выходи на связь. 
В скайпе я enzalt
Posted on Jul 3
Антон Страхов
Антон Страхов – вынес пилюли в отдельный текстовый док https://basecamp.com/1947146/projects/2807930/documents/3353998
Posted on Jul 6
Антон Страхов
Антон Страхов – добавил пометку про проверку цепочек на состояние системы ном/ослаблена.
Posted on Jul 6
Антон Страхов
Антон Страхов – Система "Эндокринная/Иммунитет" теперь = "Иммунная"
Posted on Jul 20